/* 
 * Modern 3.0
 * 
 * @license     http://www.gnu.org/licenses/agpl.html AGPL Version 3
 * @author      Michael Spahn <m.spahn@metaways.de>
 * @copyright   Copyright (c) 2012 Metaways Infosystems GmbH (http://www.metaways.de)
 */

/*global Ext, Modern*/

Ext.ns('Klb.system.widgets.form');

/**
 * This is a TriggerField which generates a random UID on click
 * (UID generated by Klb.system.data.Record.generateUID())
 * 
 * @namespace   Klb.system.widgets.form
 * @author      Michael Spahn <m.spahn@metaways.de>
 * @class       Klb.system.widgets.form.UidTriggerField
 * @extends     Ext.form.TriggerField
 */
Ext.define('Klb.system.widgets.form.UidTriggerField', {
    extend: 'Ext.form.field.Text',
    xtype: 'uxspinner',

    xtype: 'uidtriggerfield',
    itemCls: 'tw-uidTriggerField',
    enableKeyEvents: true,

    /**
     * Overrides initComponent to reenable field if it is empty
     */
    initComponent: function () {
        this.on('keyup', this.manageTriggerField);

        Klb.system.widgets.form.UidTriggerField.superclass.initComponent.call(this);
    },

    /**
     * Shows trigger field if value is empty and hides if it is filled
     */
    manageTriggerField: function () {
        this.setHideTrigger(this.getValue());
    },

    /**
     * Overrides setValue and shows trigger field if value is empty and hides if it is filled
     * 
     * @param Mixed
     * @return {Ext.form.Field} this
     */
    setValue: function (value) {
        var ret = Klb.system.widgets.form.UidTriggerField.superclass.setValue.call(this, value);

        this.manageTriggerField();
        return ret;
    },

    /**
     * Fills field on click with a random, unique checksum and hides trigger button
     */
    onTriggerClick: function () {
        if (!this.getValue()) {
            this.setValue(Klb.system.data.Record.generateUID());
            this.setHideTrigger(true);
        }
    }
});

//Ext.reg('tw-uidtriggerfield',Klb.system.widgets.form.UidTriggerField);
